{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///external \"source-map-support/register\"","webpack:///external \"ramda\"","webpack:///external \"babel-runtime/regenerator\"","webpack:///external \"babel-runtime/helpers/asyncToGenerator\"","webpack:///./utils/index.js","webpack:///external \"babel-runtime/helpers/classCallCheck\"","webpack:///external \"babel-runtime/helpers/createClass\"","webpack:///external \"babel-runtime/core-js/object/assign\"","webpack:///external \"@slack/client\"","webpack:///./utils/ResponseBuilder/index.js","webpack:///external \"babel-runtime/helpers/extends\"","webpack:///external \"babel-runtime/core-js/json/stringify\"","webpack:///./utils/buildIAMPolicy/index.js","webpack:///./utils/Ramda/index.js","webpack:///./utils/Ramda/src/splitCommas.js","webpack:///./utils/Ramda/src/joinCommas.js","webpack:///./utils/Ramda/src/transform.channels.js","webpack:///external \"babel-runtime/helpers/defineProperty\"","webpack:///./utils/dynamodb/index.js","webpack:///external \"aws-sdk\"","webpack:///./utils/slackClient/index.js","webpack:///./DAO/index.js","webpack:///./DAO/slack/slack.dao.js","webpack:///./DAO/history/history.dao.js","webpack:///./handlers/slack.auth.js","webpack:///external \"babel-runtime/helpers/slicedToArray\"","webpack:///external \"jsonwebtoken\""],"names":["ResponseBuilder","require","buildIAMPolicy","Ramda","dynamodb","slackClient","module","exports","callback","params","status","message","key","statusCode","body","response","buildResponse","id","effect","resource","context","principalId","policyDocument","Version","Statement","Action","Effect","Resource","splitCommas","joinCommas","transformChannels","R","split","join","buildChannels","reduce","acc","channel","name","AWS","options","isOffline","process","region","endpoint","console","log","client","DynamoDB","DocumentClient","WebClient","token","SlackDAO","HistoryDAO","env","CLIENT_ID","CLIENT_SECRET","web","auth","test","ok","code","client_id","client_secret","oauth","access","data","slackToken","access_token","userId","user_id","limit","conversations","list","types","channels","users","prefs","get","muted","muted_channels","idsList","set","uid","ts","Date","now","value","TableName","DYNAMODB_TABLE","Key","ReturnValues","UpdateExpression","ExpressionAttributeNames","ExpressionAttributeValues","update","promise","Attributes","history","updated","Item","index","removed","created","put","Error","jwt","paths","scopes","JWT_SECRET","buildParam","values","map","v","flattenTail","compose","tail","flatten","keyValues","head","kv","buildParams","pipe","toPairs","commas","button","event","scope","slackButton","responseBuilder","slack_button","exec","authorize","authorizationToken","unauthorized","setStatus","setMessage","decoded","verify","slackDao","isAuthorized","methodArn","queryStringParameters","historyDao","createUserIfNotExists","sign"],"mappings":"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","file":"handlers/slack.auth.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 24);\n","module.exports = require(\"source-map-support/register\");","module.exports = require(\"ramda\");","module.exports = require(\"babel-runtime/regenerator\");","module.exports = require(\"babel-runtime/helpers/asyncToGenerator\");","const ResponseBuilder = require('./ResponseBuilder');\nconst buildIAMPolicy = require('./buildIAMPolicy');\nconst Ramda = require('./Ramda');\nconst dynamodb = require('./dynamodb');\nconst slackClient = require('./slackClient');\n\nmodule.exports = {\n  ResponseBuilder,\n  buildIAMPolicy,\n  Ramda,\n  dynamodb,\n  slackClient,\n};\n","module.exports = require(\"babel-runtime/helpers/classCallCheck\");","module.exports = require(\"babel-runtime/helpers/createClass\");","module.exports = require(\"babel-runtime/core-js/object/assign\");","module.exports = require(\"@slack/client\");","\nclass ResponseBuilder {\n  constructor(callback, params = {}, status = 200) {\n    this.callback = callback;\n    this.status = status;\n    this.params = params;\n    this.message = 'Ok';\n  }\n\n  addParams(params) {\n    Object.assign(this.params, params);\n  }\n\n  removeParam(key) {\n    if (this.params[key]) {\n      delete this.params[key];\n    }\n  }\n\n  setMessage(message) {\n    this.message = message;\n  }\n\n  setStatus(status) {\n    this.status = status;\n  }\n\n  buildResponse() {\n    return {\n      statusCode: this.status,\n      body: JSON.stringify({\n        message: this.message,\n        ...this.params,\n      }),\n    };\n  }\n\n  exec() {\n    if (this.status === 200) {\n      const response = this.buildResponse();\n      return this.callback(null, response);\n    }\n\n    return this.callback(this.message !== 'Ok' ? this.message : 'Internal error');\n  }\n}\n\nmodule.exports = ResponseBuilder;\n","module.exports = require(\"babel-runtime/helpers/extends\");","module.exports = require(\"babel-runtime/core-js/json/stringify\");","\nmodule.exports = (id, effect, resource, context) => ({\n  principalId: id,\n  policyDocument: {\n    Version: '2012-10-17',\n    Statement: [\n      {\n        Action: 'execute-api:Invoke',\n        Effect: effect,\n        Resource: resource,\n      },\n    ],\n  },\n  context,\n});\n","const splitCommas = require('./src/splitCommas');\nconst joinCommas = require('./src/joinCommas');\nconst transformChannels = require('./src/transform.channels');\n\nmodule.exports = {\n  splitCommas,\n  joinCommas,\n  transformChannels,\n};\n","const R = require('ramda');\n\nmodule.exports = R.split(',');\n","const R = require('ramda');\n\nmodule.exports = R.join(',');\n","const R = require('ramda');\n\nconst buildChannels = R.reduce((acc, channel) => {\n  const { id, name } = channel;\n  return Object.assign(acc, { [id]: name });\n}, {});\n\nmodule.exports = buildChannels;\n","module.exports = require(\"babel-runtime/helpers/defineProperty\");","/* eslint-disable import/no-extraneous-dependencies */\nconst AWS = require('aws-sdk');\n\nlet options = {};\n\nconst isOffline = () => process.env.NODE_ENV === 'development';\n\nif (isOffline()) {\n  options = {\n    region: 'localhost',\n    endpoint: 'http://localhost:8000',\n  };\n}\n\nconsole.log({ options });\nconst client = new AWS.DynamoDB.DocumentClient(options);\n\nmodule.exports = client;\n","module.exports = require(\"aws-sdk\");","const { WebClient } = require('@slack/client');\n\nmodule.exports = (token) => {\n  if (token) {\n    return new WebClient(token);\n  }\n\n  return new WebClient();\n};\n","const SlackDAO = require('./slack/slack.dao');\nconst HistoryDAO = require('./history/history.dao');\n\nmodule.exports = {\n  SlackDAO,\n  HistoryDAO,\n};\n","const { WebClient } = require('@slack/client');\nconst { Ramda, slackClient } = require('../../utils');\n\nconst { splitCommas, joinCommas, transformChannels } = Ramda;\n\nconst { CLIENT_ID, CLIENT_SECRET } = process.env;\n\nclass SlackDAO {\n  constructor(token) {\n    this.client = slackClient(token);\n  }\n\n  async isAuthorized() {\n    try {\n      const { ok } = await this.client.web.auth.test();\n      return ok;\n    } catch (e) {\n      return false;\n    }\n  }\n\n  async authorize(code) {\n    const params = {\n      client_id: CLIENT_ID,\n      client_secret: CLIENT_SECRET,\n      code,\n    };\n\n    const data = await this.client.oauth.access(params);\n\n    const slackToken = data.access_token;\n    const userId = data.user_id;\n\n    return { slackToken, userId };\n  }\n\n  async getAllChannels(limit = 1000) {\n    const { channels } = await this.client.conversations.list({\n      limit,\n      types: 'public_channel,private_channel',\n    });\n\n    return transformChannels(channels);\n  }\n\n  async getMutedChannels() {\n    const { prefs } = await this.client.users.prefs.get();\n    const muted = splitCommas(prefs.muted_channels);\n\n    return muted;\n  }\n\n  async setMutedChannels(idsList) {\n    const prefs = { muted_channels: joinCommas(idsList) };\n    const response = await this.client.users.prefs.set({ prefs });\n\n    return response.prefs.muted_channels;\n  }\n}\n\nmodule.exports = SlackDAO;\n","const { dynamodb } = require('../../utils');\n\nclass HistoryDAO {\n  constructor(uid) {\n    this.uid = uid;\n  }\n\n  async appendUserHistory(muted) {\n    const ts = Date.now();\n    const value = { muted, ts };\n\n    const params = {\n      TableName: process.env.DYNAMODB_TABLE,\n      Key: {\n        uid: this.uid,\n      },\n      ReturnValues: 'ALL_NEW',\n      UpdateExpression: 'set #history = list_append(if_not_exists(#history, :empty_list), :muted)',\n      ExpressionAttributeNames: {\n        '#history': 'history',\n      },\n      ExpressionAttributeValues: {\n        ':muted': [value],\n        ':empty_list': [],\n      },\n    };\n\n    const { Attributes } = await dynamodb.update(params).promise();\n\n    if (Attributes && Attributes.history) {\n      return { updated: Attributes.history };\n    }\n\n    return { message: 'Could not save in hisotry' };\n  }\n\n  async getHisotry() {\n    const params = {\n      TableName: process.env.DYNAMODB_TABLE,\n      Key: {\n        uid: this.uid,\n      },\n    };\n\n    const { Item } = await dynamodb.get(params).promise();\n    const { history } = Item;\n\n    return history;\n  }\n\n  async removeFromHistory(index) {\n    const params = {\n      TableName: process.env.DYNAMODB_TABLE,\n      Key: {\n        uid: this.uid,\n      },\n      UpdateExpression: `REMOVE history[${index}]`,\n      ReturnValues: 'UPDATED_OLD',\n    };\n\n    const { Attributes } = await dynamodb.update(params).promise();\n\n    if (Attributes && Attributes.history) {\n      return { removed: Attributes.history[index], index };\n    }\n\n    return { removed: [] };\n  }\n\n  async createUserIfNotExists() {\n    const TableName = process.env.DYNAMODB_TABLE;\n\n    try {\n      const response = await dynamodb.get({\n        TableName,\n        Key: {\n          uid: this.uid,\n        },\n      }).promise();\n\n      if (!response.Item) {\n        const created = Date.now();\n\n        await dynamodb.put({\n          TableName,\n          Item: {\n            uid: this.uid,\n            created,\n            history: [],\n          },\n        }).promise();\n      }\n    } catch (e) {\n      throw new Error('Database problem');\n    }\n  }\n}\n\nmodule.exports = HistoryDAO;\n","const R = require('ramda');\nconst jwt = require('jsonwebtoken');\n\nconst { ResponseBuilder, buildIAMPolicy } = require('../utils');\nconst { paths, scopes } = require('../config/slack.config.json');\nconst { SlackDAO, HistoryDAO } = require('../DAO');\n\nconst { CLIENT_ID, JWT_SECRET } = process.env;\n\nconst buildParam = ([key, values]) => R.map(v => `${key}=${v}`, values);\nconst flattenTail = R.compose(R.tail, R.flatten);\nconst keyValues = R.map(kv => [R.head(kv), flattenTail(kv)]);\n\nconst buildParams = R.pipe(R.toPairs, keyValues, R.map(buildParam), R.flatten, R.join('&'));\n\nconst commas = R.join(',');\n\nmodule.exports.button = (event, context, callback) => {\n  const params = {\n    scope: commas(scopes),\n    client_id: CLIENT_ID,\n  };\n\n  const slackButton = `${paths.button}?${buildParams(params)}`;\n  const responseBuilder = new ResponseBuilder(callback, { slack_button: slackButton });\n\n  responseBuilder.exec();\n};\n\nmodule.exports.authorize = async (event, context, callback) => {\n  const { authorizationToken } = event;\n\n  const responseBuilder = new ResponseBuilder(callback);\n  const unauthorized = () => {\n    responseBuilder.setStatus(401);\n    responseBuilder.setMessage('Unauthorized');\n    responseBuilder.exec();\n  };\n\n  if (!authorizationToken) {\n    return unauthorized();\n  }\n\n  try {\n    const decoded = jwt.verify(authorizationToken, JWT_SECRET);\n    const { token, userId } = decoded;\n\n    const slackDao = new SlackDAO(token);\n\n    if (await !slackDao.isAuthorized()) {\n      return unauthorized();\n    }\n\n    const policyDocument = buildIAMPolicy(userId, 'Allow', event.methodArn, { token, userId });\n\n    return callback(null, policyDocument);\n  } catch (e) {\n    return unauthorized();\n  }\n};\n\nmodule.exports.oauth = async (event, context, callback) => {\n  const { code } = event.queryStringParameters;\n\n  try {\n    const slackDao = new SlackDAO();\n    const { slackToken, userId } = await slackDao.authorize(code);\n\n    const historyDao = new HistoryDAO(userId);\n    await historyDao.createUserIfNotExists();\n\n    const token = jwt.sign({ token: slackToken, userId }, JWT_SECRET);\n\n    const responseBuilder = new ResponseBuilder(callback, { token });\n\n    responseBuilder.exec();\n  } catch (e) {\n    console.log(e);\n    const responseBuilder = new ResponseBuilder(callback);\n    responseBuilder.setStatus(500);\n    responseBuilder.setMessage('Database problem');\n\n    responseBuilder.exec();\n  }\n};\n","module.exports = require(\"babel-runtime/helpers/slicedToArray\");","module.exports = require(\"jsonwebtoken\");"],"sourceRoot":""}